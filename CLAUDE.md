# MigrantHub — Правила разработки

## Правило выполнения задач

При получении любой задачи:

### 1. Оценка сложности
- Оценить объём кода и количество файлов
- Определить, поместится ли в одно контекстное окно
- Учесть зависимости между частями

### 2. Решение о декомпозиции
**Если задача помещается в контекст:**
- Выполнить полностью
- Проверить работоспособность
- Отчитаться о результате

**Если задача НЕ помещается:**
- Разбить на подзадачи (каждая = 1 контекстное окно)
- Написать детальный промпт для каждой подзадачи
- Указать зависимости между подзадачами
- Передать пользователю для запуска отдельных агентов

### 3. Формат промпта для подзадачи
```
## Задача: [Название]

## Контекст
[Что уже сделано, какие файлы существуют]

## Цель
[Конкретный результат]

## Шаги
1. [Шаг 1]
2. [Шаг 2]
...

## Файлы для создания/изменения
- path/to/file1.ts
- path/to/file2.ts

## Критерии готовности
- [ ] Критерий 1
- [ ] Критерий 2

## После завершения
[Что проверить, какую команду запустить]
```

### 4. Качество кода
- Код должен компилироваться без ошибок
- Следовать существующим паттернам проекта
- Не оставлять TODO без реализации
- Тестировать после написания

### 5. Git commit после каждой задачи
После успешного завершения задачи:
- Автоматически делать git commit
- Генерировать осмысленный commit message
- Формат: `feat/fix/refactor: краткое описание`
- Не push без явного запроса пользователя

---

## Технический стек

### Backend (apps/api-core)
- NestJS 10
- TypeScript strict
- PostgreSQL 16 + TypeORM
- Redis 7
- class-validator + class-transformer
- Swagger/OpenAPI

### Frontend (apps/frontend)
- Next.js 14 (App Router)
- React 18 + TypeScript
- Zustand (state)
- TanStack Query v5
- Tailwind CSS
- Capacitor 8 (mobile)
- Dexie.js (IndexedDB)

### Infrastructure
- Docker Compose
- GitHub Actions
- Sentry (monitoring)

---

## Архитектурные принципы

1. **Local-First** — ПДн только на устройстве
2. **Не оператор 152-ФЗ** — сервер не хранит персональные данные
3. **E2E шифрование** — для Cloud Safe (v1.1)
4. **Offline-capable** — основные функции работают без сети

---

## Структура проекта

```
migranthub_g/
├── apps/
│   ├── api-core/        # NestJS backend (MVP)
│   ├── frontend/        # Next.js + Capacitor
│   └── legal-core/      # Law monitoring (готов)
├── docs/
│   ├── architecture/    # Спецификации
│   ├── TECHNICAL_SPECIFICATION.md
│   └── MVP_PRIORITIZATION.md
└── CLAUDE.md            # Этот файл
```

---

## Текущий статус MVP

- [x] Документация архитектуры
- [x] Техническое задание
- [x] Приоритизация MVP
- [x] GitHub Issues созданы
- [x] #4 Backend Setup
- [x] #5 Auth Module (Device Auth)
- [ ] #6 User Module
- [ ] #7 Utilities API
- [ ] Frontend Integration (#2)
- [ ] Infrastructure (#3)
